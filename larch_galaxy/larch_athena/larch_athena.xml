<tool id="larch_athena" name="Larch Athena" version="@TOOL_VERSION@+galaxy@WRAPPER_VERSION@" python_template_version="3.5" profile="22.05" license="MIT">
    <description>generate Athena projects from XAFS data</description>
    <macros>
        <!-- version of underlying tool (PEP 440) -->
        <token name="@TOOL_VERSION@">0.9.66</token>
        <!-- version of this tool wrapper (integer) -->
        <token name="@WRAPPER_VERSION@">0</token>
        <!-- citation should be updated with every underlying tool version -->
        <!-- typical fields to update are version, month, year, and doi -->
        <token name="@TOOL_CITATION@">10.1088/1742-6596/430/1/012007</token>
    </macros>
    <creator>
        <person givenName="Patrick" familyName="Austin" url="https://github.com/patrick-austin"/>
        <organization url="https://muon-spectroscopy-computational-project.github.io/index.html" name="The Muon Spectroscopy Computational Project"/>
    </creator>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">xraylarch</requirement>
        <requirement type="package" version="3.5.1">matplotlib</requirement>
    </requirements>
    <required_files>
        <include type="literal" path="larch_athena.py"/>
    </required_files>
    <command detect_errors="exit_code"><![CDATA[
        python '${__tool_directory__}/larch_athena.py' '$dat_file' '$plot_graph'
    ]]></command>
    <inputs>
        <param name="dat_file" type="data" format="txt" label="XAFS data file" help="Normalised X-ray Absorption Fine Structure (XAFS) data, generated by DAWN."/>
        <param name="plot_graph" type="boolean" label="Plot graph" help="Whether to plot the pre and post edge fitting to the xμ data."/>
    </inputs>
    <outputs>
        <data name="athena_project_file" format="binary" from_work_dir="out.prj" label="Athena project of ${dat_file.name}"/>
        <data name="plot" format="png" from_work_dir="out.png" label="Plot of ${dat_file.name}">
            <filter>plot_graph</filter>
        </data>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="dat_file" value="test.xmu"/>
            <output name="athena_project_file">
                <assert_contents>
                    <has_size value="14785" delta="20"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="2">
            <param name="dat_file" value="test.xmu"/>
            <param name="plot_graph" value="true"/>
            <output name="athena_project_file">
                <assert_contents>
                    <has_size value="14785" delta="20"/>
                </assert_contents>
            </output>
            <output name="plot">
                <assert_contents>
                    <has_size value="14785" delta="20"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
        Using Larch, create an Athena project file from the input X-ray Absorption Fine Structure (XAFS) data file. This renames the `xmu` column of the data to `mu`.

        Optionally, plot the xμ data along with pre and post edge fitting lines for visual inspection. 
    ]]></help>
    <citations>
        <citation type="bibtex">@TOOL_CITATION@</citation>
        <citation type="doi">10.1107/S0909049505012719</citation>
    </citations>
</tool>