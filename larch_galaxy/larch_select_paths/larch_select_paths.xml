<tool id="larch_select_paths" name="Larch Select Paths" version="@TOOL_VERSION@+galaxy@WRAPPER_VERSION@" python_template_version="3.5" profile="22.05" license="MIT">
    <description>select FEFF paths for XAFS data</description>
    <macros>
        <!-- version of underlying tool (PEP 440) -->
        <token name="@TOOL_VERSION@">0.9.66</token>
        <!-- version of this tool wrapper (integer) -->
        <token name="@WRAPPER_VERSION@">0</token>
        <!-- citation should be updated with every underlying tool version -->
        <!-- typical fields to update are version, month, year, and doi -->
        <token name="@TOOL_CITATION@">10.1088/1742-6596/430/1/012007</token>
    </macros>
    <creator>
        <person givenName="Patrick" familyName="Austin" url="https://github.com/patrick-austin"/>
        <organization url="https://muon-spectroscopy-computational-project.github.io/index.html" name="The Muon Spectroscopy Computational Project"/>
    </creator>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">xraylarch</requirement>
        <requirement type="package" version="3.5.2">matplotlib</requirement>
        <!-- xraydb 4.5.0 is compatible with sqlalchemy 2, but is not yet available on condaforge so pin it -->
        <requirement type="package" version="4.4.7">xraydb</requirement>
        <requirement type="package" version="1.4.46">sqlalchemy</requirement>
        <requirement type="package" version="2023.3.23">pymatgen</requirement>
    </requirements>
    <required_files>
        <include type="literal" path="larch_select_paths.py"/>
    </required_files>
    <command detect_errors="exit_code"><![CDATA[
        python '${__tool_directory__}/larch_select_paths.py' '$paths_file' '$inputs'
    ]]></command>
    <configfiles>
        <inputs name="inputs"/>
    </configfiles>
    <inputs>
        <param name="paths_file" type="data" format="csv" label="Paths file" help="CSV file detailing the possible scattering paths. Note that rows with '1' in the 'select' column will be selected with default values for their parameters automatically."/>
        <repeat name="paths" title="Select paths" help="Identify paths to use in the fitting by their id, and define their parameters. Defaults can be used, but if custom values are needed define a new name and create an entry in Custom GDS variables.">
            <param name="id" type="integer" value="1" min="1" label="Path ID" help="Numerical id of a path to select, this appears at the end of the label and filename in the path summary CSV."/>
            <param name="s02" type="text" value="amp" label="s02"/>
            <param name="e0" type="text" value="enot" label="e0"/>
            <param name="sigma2" type="text" optional="true" label="sigma2" help="If not set, will create a 'Custom GDS variable' with default values."/>
            <param name="deltar" type="text" value="alpha*reff" label="deltar"/>
        </repeat>
        <repeat name="gds" title="Custom GDS variables" help="Guess, Set, Define (GDS) variables for the selected paths.">
            <param name="name" type="text" label="Name" help="The name of the variable should match what is used in the Select paths section"/>
            <param name="value" type="float" value="0.003" label="Value" help="The initial value for the variable."/>
            <param name="expr" type="text" optional="true" label="Expression" help="If set, the variable will be 'Defined' by the expression. This can include other variable name, for example in order to set two paths to use the same variable."/>
            <param name="vary" type="boolean" checked="true" label="Vary" help="If True, the initial 'Guess' will be optimised in the fitting. If False, the value will be 'Set' instead and not optimised."/>
        </repeat>
        <section name="amp" title="GDS default (amp)" help="Default value used for the s02 parameter for all paths. Changing this will affect all paths without a custom variable defined for 's02'.">
            <param name="value" type="float" value="1.0" label="Value" help="The initial value for the variable."/>
            <param name="expr" type="text" optional="true" label="Expression" help="If set, the variable will be 'Defined' by the expression. This can include other variable name, for example in order to set two paths to use the same variable."/>
            <param name="vary" type="boolean" checked="true" label="Vary" help="If True, the initial 'Guess' will be optimised in the fitting. If False, the value will be 'Set' instead and not optimised."/>
        </section>
        <section name="enot" title="GDS default (enot)" help="Default value used for the e0 parameter for all paths. Changing this will affect all paths without a custom variable defined for 'e0'.">
            <param name="value" type="float" value="1e-7" label="Value" help="The initial value for the variable."/>
            <param name="expr" type="text" optional="true" label="Expression" help="If set, the variable will be 'Defined' by the expression. This can include other variable name, for example in order to set two paths to use the same variable."/>
            <param name="vary" type="boolean" checked="true" label="Vary" help="If True, the initial 'Guess' will be optimised in the fitting. If False, the value will be 'Set' instead and not optimised."/>
        </section>
        <section name="alpha" title="GDS default (alpha)" help="Default value used for the deltar parameter for all paths. Changing this will affect all paths without a custom variable defined for 'deltar'.">
            <param name="value" type="float" value="1e-7" label="Value" help="The initial value for the variable."/>
            <param name="expr" type="text" optional="true" label="Expression" help="If set, the variable will be 'Defined' by the expression. This can include other variable name, for example in order to set two paths to use the same variable."/>
            <param name="vary" type="boolean" checked="true" label="Vary" help="If True, the initial 'Guess' will be optimised in the fitting. If False, the value will be 'Set' instead and not optimised."/>
        </section>
    </inputs>
    <outputs>
        <data name="gds_csv" format="csv" from_work_dir="gds.csv" label="GDS values of ${paths_file.name}"/>
        <data name="sp_csv" format="csv" from_work_dir="sp.csv" label="Selected paths of ${paths_file.name}"/>
    </outputs>
    <tests>
    </tests>
    <help><![CDATA[
        Select FEFF scattering paths to use in the fitting process.

        Rows in the CSV with ``select`` set to ``1`` will be automatically used, with the default values shown here.
        This can be useful when many paths are needed and using the UI can be cumbersome.

        It is also possible to manually check and further modify the GDS and SP output CSVs to ensure the values are suitable, as an alternative to re-running this tool.
    ]]></help>
    <citations>
        <citation type="doi">@TOOL_CITATION@</citation>
        <citation type="doi">10.1107/S0909049505012719</citation>
    </citations>
</tool>